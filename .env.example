# Crab Trading - environment template
# Copy to .env (or use your deployment secret manager).
# Never commit real credentials.

# ------------------------------------------------------------
# Core app
# ------------------------------------------------------------
# Build profile: private (default) or public.
CRAB_BUILD_PROFILE=private
CRAB_PRIMARY_HOST=your-domain.example
CRAB_REQUIRE_TWITTER_CLAIM=false
CRAB_HIDE_TEST_DATA=true
CRAB_RATE_LIMIT_PER_SECOND=10

# Runtime state paths (defaults shown)
CRAB_STATE_FILE=~/.local/share/crab-trading/runtime_state.json
CRAB_STATE_DB=~/.local/share/crab-trading/runtime_state.db

# Owner session hash key (required in production startup checks)
CRAB_OWNER_SESSION_HASH_KEY=

# ------------------------------------------------------------
# Live trading isolation (Binance US)
# ------------------------------------------------------------
# Keep live data isolated from simulation state.
CRAB_LIVE_DB=~/.local/share/crab-trading/live_state.db
# Global kill switch for live order submission.
CRAB_LIVE_ENABLED_GLOBAL=false

# Local encrypted secret storage (required for live connect)
CRAB_LIVE_SECRET_MASTER_KEY=
CRAB_LIVE_SECRET_KEY_VERSION=v1
# Optional previous master keys for key rotation/decryption fallback.
CRAB_LIVE_SECRET_PREV_KEYS=

# Binance US API
CRAB_BINANCE_US_BASE_URL=https://api.binance.us
CRAB_BINANCE_HTTP_TIMEOUT_SECONDS=8
CRAB_BINANCE_RECV_WINDOW_MS=5000

# Live admin network allowlist (comma-separated CIDRs) for /web/admin/live/*
# If empty, service falls back to private/loopback ranges only.
CRAB_LIVE_ADMIN_ALLOWLIST=
CRAB_LIVE_ADMIN_ALLOWLIST_FILE=~/.config/crab-trading/live_admin_allowlist

# High-risk control-plane approval mode:
# - single_admin_fallback (default): executes with strong audit tag until you add real 2nd approver
# - strict_two_person: requires two distinct admins for high-risk changes
# - disabled: immediate execution (not recommended for production)
CRAB_LIVE_APPROVAL_MODE=single_admin_fallback
CRAB_LIVE_APPROVAL_TTL_MINUTES=30
CRAB_LIVE_APPROVAL_REQUIRE_DISTINCT_ADMINS=true
# Optional bootstrap approver ids (comma-separated), e.g. alice,bob
CRAB_LIVE_APPROVER_IDS=

# Signer sidecar (recommended for production): live-api sends orders to signer,
# signer holds/uses exchange secrets. Leave CRAB_LIVE_SIGNER_URL empty to disable.
CRAB_LIVE_SIGNER_URL=
CRAB_LIVE_SIGNER_TIMEOUT_SECONDS=8
CRAB_LIVE_SIGNER_SHARED_TOKEN=
CRAB_LIVE_SIGNER_ALLOWLIST=127.0.0.1/32,::1/128
CRAB_LIVE_SIGNER_TS_TOLERANCE_SECONDS=60
# Optional mTLS (recommended when signer is on another host)
CRAB_LIVE_SIGNER_MTLS_CERT=
CRAB_LIVE_SIGNER_MTLS_KEY=
CRAB_LIVE_SIGNER_MTLS_CA=

# Require explicit acknowledgement that Binance key IP allowlist is configured.
CRAB_LIVE_REQUIRE_IP_WHITELIST_CONFIRM=true

# Live default (agent-level) risk caps
CRAB_LIVE_DEFAULT_MAX_ORDER_NOTIONAL_USD=100
CRAB_LIVE_DEFAULT_MAX_DAILY_NOTIONAL_USD=500
CRAB_LIVE_DEFAULT_MAX_OPEN_ORDERS=5
CRAB_LIVE_DEFAULT_MAX_SLIPPAGE_BPS=120
CRAB_LIVE_DEFAULT_MAX_CONSECUTIVE_FAILURES=3

# Global hard caps (cannot be exceeded by agent-level policy)
CRAB_LIVE_HARD_MAX_ORDER_NOTIONAL_USD=1000
CRAB_LIVE_HARD_MAX_DAILY_NOTIONAL_USD=10000
CRAB_LIVE_HARD_MAX_OPEN_ORDERS=50
CRAB_LIVE_HARD_MAX_SLIPPAGE_BPS=300
CRAB_LIVE_HARD_MAX_CONSECUTIVE_FAILURES=15
CRAB_LIVE_HARD_MAX_DAILY_LOSS_USD=500

# ------------------------------------------------------------
# Admin security
# ------------------------------------------------------------
# Option A: direct token (recommended only in secret manager)
CRAB_ADMIN_TOKEN=
# Option B: file-based token (preferred on Linux servers)
CRAB_ADMIN_TOKEN_FILE=~/.config/crab-trading/admin_token
# Optional CIDR allowlist for admin endpoints (comma-separated)
# Example: office/public egress CIDRs for your own environment
CRAB_ADMIN_ALLOWLIST=
CRAB_ADMIN_ALLOWLIST_FILE=~/.config/crab-trading/admin_allowlist

# ------------------------------------------------------------
# Market data (Alpaca)
# Provide one API key pair using any supported variable names.
# ------------------------------------------------------------
APCA_API_KEY_ID=
APCA_API_SECRET_KEY=
# ALPACA_API_KEY_ID=
# ALPACA_API_SECRET_KEY=
# ALPACA_API_KEY=
# ALPACA_SECRET_KEY=
# ALPACA_API_SECRET=

ALPACA_DATA_BASE_URL=https://data.alpaca.markets
CRAB_MARKET_DATA_TIMEOUT_SECONDS=2.5
CRAB_POLYMARKET_HTTP_TIMEOUT_SECONDS=4.0

# ------------------------------------------------------------
# Optional behavior tuning
# ------------------------------------------------------------
CRAB_DAILY_STRATEGY_SUMMARIES=true
CRAB_DAILY_STRATEGY_RUN_HOUR_UTC=0
CRAB_DAILY_STRATEGY_RUN_MINUTE_UTC=12
CRAB_SKILL_UPDATE_CHECK_SECONDS=21600

CRAB_GEOIP_LOOKUP_ENABLED=true
CRAB_GEOIP_LOOKUP_TIMEOUT_SECONDS=1.8
CRAB_GEOIP_CACHE_TTL_SECONDS=86400
CRAB_GEOIP_CACHE_MISS_TTL_SECONDS=1800

# OpenClaw One-Link signature verification
# Format: key_id:secret,key_id2:secret2
CRAB_OPENCLAW_SIGNING_KEYS=
# Optional single key shortcut
CRAB_OPENCLAW_KEY_ID=
CRAB_OPENCLAW_KEY_SECRET=
CRAB_OPENCLAW_CLOCK_SKEW_SECONDS=300
CRAB_OPENCLAW_NONCE_TTL_SECONDS=600

# Telegram callback delivery for One-Link follow alerts
CRAB_TELEGRAM_BOT_TOKEN=

# Optional mint override (pre-IPO token lookup fallback)
# CRAB_SOL_MINT_SPACEX=PreANxuXjsy2pvisWWMNB6YaJNzr7681wJJr2rHsfTh

# ------------------------------------------------------------
# Optional deploy helper defaults (deploy.py / release_flow.sh)
# ------------------------------------------------------------
CRAB_DEPLOY_TARGET=prod
CRAB_REMOTE_HOST=
CRAB_REMOTE_DIR=
CRAB_SERVICE_NAME=
CRAB_HEALTH_HOST=
CRAB_HEALTH_PATH=/health

# ------------------------------------------------------------
# Strict startup checks (recommended for production)
# If true, app exits when critical secrets are missing.
# ------------------------------------------------------------
CRAB_STRICT_STARTUP_SECRETS=false
